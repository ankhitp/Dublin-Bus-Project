{% extends 'base.html' %}
{% block content %}
    {% load static %}
    {% if user.is_authenticated %}

        <script>
            var user = '{{ user.username }}';
            var favs = '{{ user.favourites }}';
        </script>


        <script async defer
                src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBvFaUDR5Wnl172znC5agS97gPJmyXHwOs&libraries=places&callback=initMap">
        </script>
        <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js" type="text/javascript"></script>
        <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js" type="text/javascript"></script>
        <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
        <link crossorigin="anonymous" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css"
              integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" rel="stylesheet">
        <script src="https://unpkg.com/gijgo@1.9.13/js/gijgo.min.js" type="text/javascript"></script>
        <link href="https://unpkg.com/gijgo@1.9.13/css/gijgo.min.css" rel="stylesheet" type="text/css"/>

        <script>
            function setAutocomplete() {
                var originInput = document.getElementById('origin-input');
                var destinationInput = document.getElementById('destination-input');
                //define a center and circle for our autocomplete search, this makes it so that it's biased toward this area when
                //searching for a place name
                var center = new google.maps.LatLng(53.33306, -6.24889);
                var circle = new google.maps.Circle({
                    center: center,
                    radius: 10000
                });
                //setting up the autcomplete and adding the bound circle of 10KM for suggestions
                var originAutocomplete = new google.maps.places.Autocomplete(originInput);
                // set route numbers here?
                setTimeout(function () {
                    $(".pac-container").append('<div id="are" class="pac-item" onmousedown="alert(\'Yes workingt\')"><span class="pac-icon icon-airport"></span><span class="pac-item-query"><span class="pac-matched"></span>sample Address</span> <span>it\'s Working</span></div>');
                }, 500);
                var destinationAutocomplete = new google.maps.places.Autocomplete(destinationInput);
                originAutocomplete.setBounds(circle.getBounds());
                destinationAutocomplete.setBounds(circle.getBounds());
                this.setupPlaceChangedListener(originAutocomplete, 'ORIG');
                this.setupPlaceChangedListener(destinationAutocomplete, 'DEST');
                var marker = new google.maps.Marker({position: dublin, map: map});
            }
        </script>
        <div class="container-fluid">
            <div class="row" id="header-row">
                <div class="col-3">
                    <img class="smalllogo" src="{% static 'smalllogo.png' %}">
                </div>
                <div class="col-6">
                    <p>Favourites</p>
                </div>
                <div class="col-3">
                </div>
            </div>
            Hi {{ user.username }}!
            <button class='btn btn-light btn-sm'>
                <a href="{% url 'logout' %}">logout</a>
            </button>
            <div class="row" style="overflow: auto">
                <div class="col-12" id="middle-favourite">
                    <!-- <p>middle section</p> -->
                    <div class="col-12" id="favourite-holder">
                        <div id="favourite-Add">
                            <div id="add-holder">
                                <p>Add new favourite route
                                    <button aria-pressed="false" autocomplete="off" class="btn btn-primary"
                                            data-toggle="button"
                                            id="add-button" type="button">
                                        <i class="fas fa-plus-circle" id="plusicon"></i>
                                    </button>
                                </p>
                            </div>
                        </div>
                        <br><br>


                        <div id="favourite-Input">
                            <div id="input-holder">
                                <form method="POST">
                                    {% csrf_token %}

                                    <div class="field-wrap">
                                        <label for="origin-input"> Start: </label>
                                        <input autocomplete="off" class="controls" id="origin-input" type="text">

                                    </div>
                                    <br>

                                    <div class="field-wrap">
                                        <label for="destination-input">Destination: </label>
                                        <input autocomplete="off" class="controls" id="destination-input" type="text">
                                        <script>setAutocomplete()</script>
                                    </div>

                                    <!-- {{ form.as_p }} -->
                                    <button class="btn btn-primary" id="addfavourite" onclick="updateUserFav(user)"
                                            type="button">Submit
                                    </button>
                                </form>
                            </div>
                        </div>


                        <div id="one-holder"></div>

                        <!-- <div id="one-holder">
                        <div class="flex-container">
                              <div id="flex1div">1</div>
                              <div id="flex2div">
                                 <button type="button" class="btn btn-primary" id="planJourney">Plan Journey</button>
                              </div>
                           </div>
                           </div> -->


                    </div>

                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-12">
                {% include 'tabs.html' %}
            </div>
        </div>
        <script>
            window.onload = function () {
                var myHtml = "";
                if (favs.length > 0) {
                    var favsArray = favs.split('*');
                    for (var i = 0; i < favsArray.length; i++) {
                        var startStop = favsArray[i].split(':');
                        var startLoc = startStop[0];
                        var endLoc = startStop[1];
                        var startLocShort = startLoc.split(",")[0];
                        var endLocShort = endLoc.split(",")[0];
                        startLoc = startLoc.replace("&#39;", "");
                        endLoc = endLoc.replace("&#39;", "");
                        myHtml +=
                            "<div class=flex-container>" +
                            "   <div id=flex1div>" +
                            "       <b>From: </b>" + startLocShort + "<br>" +
                            "       <b> To: </b>" + endLocShort +
                            "   </div>" +
                            "   <div id=flex2div>" +
                            "       <button style = 'width:auto; height:auto' type=button class='btn btn-primary btn-block' id=\"planJourney\" onclick=\"getFavRoute('" + startLoc + "','" + endLoc + "')\">Plan Journey</button>" +
                            "   </div>" +
                            "</div><br>";
                    }
                    document.getElementById("one-holder").innerHTML = myHtml;
                    document.getElementById("favourite-Add").style.display = "block";
                    document.getElementById("favourite-Input").style.display = "none";
                    document.getElementById("one-holder").style.display = "block";
                }
            }
        </script>
    {% else %}


        {% include 'mobile/m_favLogin.html' %}

    {% endif %}
    <link href="{% static 'css/m_favourites.css' %}" rel="stylesheet">
    <script src="{% static '/js/addfavourite.js' %}"></script>
    <script src="{% static '/js/createfavourite.js' %}"></script>

    <script src="{% static '/js/map.js' %}"></script>
    <script src="{% static '/js/choosefavourite.js' %}"></script>
    <script src="{% static 'js/favRoute.js' %}"></script>

    <script src="{% static '/js/toword.js' %}"></script>
    <script src="{% static '/js/mobile_getRoute.js' %}"></script>
    <script src="{% static '/js/getLatLong.js' %}"></script>
    <script src="{% static '/js/findLocation.js' %}"></script>

{% endblock %}